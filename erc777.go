// Copyright Â© 2019 Weald Technology Trading
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package testchain

import (
	"context"
	"math/big"

	"github.com/ethereum/go-ethereum/common"
)

// DeployERC777 deploys an ERC-777 token to the blockchain.
// The token has the following attributes:
//  - Name: Test ERC-777 Token
//  - Symbol: ERC777
//  - Granularity: user-defined
//  - Total supply: 100000000000000000000000000
func DeployERC777(tc *TestChain, granularity *big.Int, creator common.Address) (*common.Address, error) {
	bin := common.FromHex("60806040523480156200001157600080fd5b50604051620050cf380380620050cf833981018060405260e08110156200003757600080fd5b8151602083018051919392830192916401000000008111156200005957600080fd5b820160208101848111156200006d57600080fd5b81516401000000008111828201871017156200008857600080fd5b50509291906020018051640100000000811115620000a557600080fd5b82016020810184811115620000b957600080fd5b8151640100000000811182820187101715620000d457600080fd5b505060208201516040830151606090930180519295919491926401000000008111156200010057600080fd5b820160208101848111156200011457600080fd5b81518560208202830111640100000000821117156200013257600080fd5b50506020918201513360008181526001808652604080832081517f5f73757065727573657200000000000000000000000000000000000000000000808252835191829003600a90810183208752928a5294839020805460ff191685179055938452815193849003018320918352519497509295508b94929391927f130ea6d934468d638479aa8899db8fe00b15527ac6b7ded4fb291b6423fc128392918290030190a36002556003805460ff191690558551620001f790600690602089019062000b41565b5084516200020d90600790602088019062000b41565b506008849055836200026b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526022815260200180620050416022913960400191505060405180910390fd5b6001600160a01b0381166200036957604051620002889062000bc6565b604051809103906000f080158015620002a5573d6000803e3d6000fd5b50600980546001600160a01b0319166001600160a01b039290921691909117905582156200036357838381620002d757fe5b061562000330576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526030815260200180620050116030913960400191505060405180910390fd5b6200036333338560405180602001604052806000815250604051806020016040528060008152506200045060201b60201c565b62000385565b600980546001600160a01b0319166001600160a01b0383161790555b81516200039a90600b90602085019062000bd4565b5060005b600b54811015620003fa576001600c6000600b8481548110620003bd57fe5b6000918252602080832091909101546001600160a01b031683528201929092526040019020805460ff19169115159190911790556001016200039e565b50620004436040518060400160405280600b81526020017f455243373737546f6b656e00000000000000000000000000000000000000000081525060016200086060201b60201c565b5050505050505062000c81565b60085483816200045c57fe5b0615620004b5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526028815260200180620050a76028913960400191505060405180910390fd5b600954604080517f40c10f190000000000000000000000000000000000000000000000000000000081526001600160a01b03878116600483015260248201879052915191909216916340c10f1991604480830192600092919082900301818387803b1580156200052457600080fd5b505af115801562000539573d6000803e3d6000fd5b50505050600062000586856040518060400160405280601581526020017f455243373737546f6b656e73526563697069656e7400000000000000000000008152506200090a60201b60201c565b90506001600160a01b0381166200060657620005a88562000a2b60201b60201c565b1562000600576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526044815260200180620050636044913960600191505060405180910390fd5b62000736565b806001600160a01b03166223de298760008888876040518663ffffffff1660e01b815260040180866001600160a01b03166001600160a01b03168152602001856001600160a01b03166001600160a01b03168152602001846001600160a01b03166001600160a01b031681526020018381526020018060200180602001838103835260008152602001602001838103825284818151815260200191508051906020019080838360005b83811015620006c9578181015183820152602001620006af565b50505050905090810190601f168015620006f75780820380516001836020036101000a031916815260200191505b50975050505050505050600060405180830381600087803b1580156200071c57600080fd5b505af115801562000731573d6000803e3d6000fd5b505050505b846001600160a01b0316866001600160a01b03167f2fe5be0146f74c5bce36c0b80911af6c7d86ff27e89d5cfa61fc681327954e5d868686604051808481526020018060200180602001838103835285818151815260200191508051906020019080838360005b83811015620007b75781810151838201526020016200079d565b50505050905090810190601f168015620007e55780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b838110156200081a57818101518382015260200162000800565b50505050905090810190601f168015620008485780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a3505050505050565b6000826040516020018082805190602001908083835b60208310620008975780518252601f19909201916020918201910162000876565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f1901835284528151918101919091206000818152918290529290208054600160ff199091161790555092505082159050620009055762000905833062000a3160201b60201c565b505050565b600080826040516020018082805190602001908083835b60208310620009425780518252601f19909201916020918201910162000921565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f190183528085528251928201929092207faabbb8ca0000000000000000000000000000000000000000000000000000000083526001600160a01b038b166004840152602483018190529351939650731820a4b7618bde71dce8cdc73aab6c95905fad24955063aabbb8ca94506044808301949193509091829003018186803b158015620009f557600080fd5b505afa15801562000a0a573d6000803e3d6000fd5b505050506040513d602081101562000a2157600080fd5b5051949350505050565b3b151590565b6000826040516020018082805190602001908083835b6020831062000a685780518252601f19909201916020918201910162000a47565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f19018352808552825192909101919091207f29965a1d000000000000000000000000000000000000000000000000000000008252306004830152602482018190526001600160a01b03881660448301529251929550731820a4b7618bde71dce8cdc73aab6c95905fad2494506329965a1d9350606480820193600093509182900301818387803b15801562000b2357600080fd5b505af115801562000b38573d6000803e3d6000fd5b50505050505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1062000b8457805160ff191683800117855562000bb4565b8280016001018555821562000bb4579182015b8281111562000bb457825182559160200191906001019062000b97565b5062000bc292915062000c3a565b5090565b610bd2806200443f83390190565b82805482825590600052602060002090810192821562000c2c579160200282015b8281111562000c2c57825182546001600160a01b0319166001600160a01b0390911617825560209092019160019091019062000bf5565b5062000bc292915062000c5a565b62000c5791905b8082111562000bc2576000815560010162000c41565b90565b62000c5791905b8082111562000bc25780546001600160a01b031916815560010162000c61565b6137ae8062000c916000396000f3fe608060405234801561001057600080fd5b50600436106101fb5760003560e01c806370a082311161011a578063b4d9272f116100ad578063dcdc7dd01161007c578063dcdc7dd0146106f6578063e21c478314610834578063fad8b32a14610860578063fc673c4f14610886578063fe9d930314610959576101fb565b8063b4d9272f146105fe578063d55ec697146106a4578063d95b6371146106ac578063da748b10146106ee576101fb565b8063975057e7116100e9578063975057e7146105455780639bd9bbc61461054d578063a4874d77146105d0578063a795307e146105d8576101fb565b806370a08231146104e95780637e5cd5c11461050f578063959b8c3f1461051757806395d89b411461053d576101fb565b8063249cb3fa116101925780633f4ba83a116101615780633f4ba83a146103f357806354fd4d50146103fb578063556f0dc71461040357806362ad1b831461040b576101fb565b8063249cb3fa146103675780632b5074351461039357806336f2c437146103b75780633b424f09146103bf576101fb565b80630f15f4c0116101ce5780630f15f4c01461030b578063112bbe2014610313578063136439dd1461033057806318160ddd1461034d576101fb565b806306e485381461020057806306fdde03146102585780630ba12c83146102d55780630c3f6acf146102df575b600080fd5b6102086109ce565b60408051602080825283518183015283519192839290830191858101910280838360005b8381101561024457818101518382015260200161022c565b505050509050019250505060405180910390f35b610260610a4f565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561029a578181015183820152602001610282565b50505050905090810190601f1680156102c75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102dd610af7565b005b6102e7610c4b565b604051808260048111156102f757fe5b60ff16815260200191505060405180910390f35b6102dd610c54565b6102dd6004803603602081101561032957600080fd5b5035610d44565b6102dd6004803603602081101561034657600080fd5b5035610e8a565b610355610fab565b60408051918252519081900360200190f35b6103556004803603604081101561037d57600080fd5b50803590602001356001600160a01b031661104b565b61039b6110ba565b604080516001600160a01b039092168252519081900360200190f35b6102dd6110c9565b6102dd600480360360608110156103d557600080fd5b506001600160a01b038135169060208101359060400135151561122e565b6102dd611330565b610355611411565b610355611417565b6102dd600480360360a081101561042157600080fd5b6001600160a01b03823581169260208101359091169160408201359190810190608081016060820135600160201b81111561045b57600080fd5b82018360208201111561046d57600080fd5b803590602001918460018302840111600160201b8311171561048e57600080fd5b919390929091602081019035600160201b8111156104ab57600080fd5b8201836020820111156104bd57600080fd5b803590602001918460018302840111600160201b831117156104de57600080fd5b50909250905061143f565b610355600480360360208110156104ff57600080fd5b50356001600160a01b03166114df565b6102dd611582565b6102dd6004803603602081101561052d57600080fd5b50356001600160a01b0316611693565b610260611797565b61039b611812565b6102dd6004803603606081101561056357600080fd5b6001600160a01b0382351691602081013591810190606081016040820135600160201b81111561059257600080fd5b8201836020820111156105a457600080fd5b803590602001918460018302840111600160201b831117156105c557600080fd5b509092509050611821565b6102dd611898565b6102dd600480360360208110156105ee57600080fd5b50356001600160a01b0316611975565b6102dd6004803603604081101561061457600080fd5b810190602081018135600160201b81111561062e57600080fd5b82018360208201111561064057600080fd5b803590602001918460018302840111600160201b8311171561066157600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295505050503515159050611ad1565b6102dd611b6b565b6106da600480360360408110156106c257600080fd5b506001600160a01b0381358116916020013516611c2a565b604080519115158252519081900360200190f35b610355611cb0565b6102dd6004803603608081101561070c57600080fd5b6001600160a01b0382351691602081013591810190606081016040820135600160201b81111561073b57600080fd5b82018360208201111561074d57600080fd5b803590602001918460018302840111600160201b8311171561076e57600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b8111156107c057600080fd5b8201836020820111156107d257600080fd5b803590602001918460018302840111600160201b831117156107f357600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550611cb6945050505050565b6106da6004803603604081101561084a57600080fd5b506001600160a01b038135169060200135611d80565b6102dd6004803603602081101561087657600080fd5b50356001600160a01b0316611df7565b6102dd6004803603608081101561089c57600080fd5b6001600160a01b0382351691602081013591810190606081016040820135600160201b8111156108cb57600080fd5b8201836020820111156108dd57600080fd5b803590602001918460018302840111600160201b831117156108fe57600080fd5b919390929091602081019035600160201b81111561091b57600080fd5b82018360208201111561092d57600080fd5b803590602001918460018302840111600160201b8311171561094e57600080fd5b509092509050611efb565b6102dd6004803603604081101561096f57600080fd5b81359190810190604081016020820135600160201b81111561099057600080fd5b8201836020820111156109a257600080fd5b803590602001918460018302840111600160201b831117156109c357600080fd5b509092509050611f8f565b606060018060035460ff1660048111156109e457fe5b146109ee57600080fd5b600b805480602002602001604051908101604052809291908181526020018280548015610a4457602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311610a26575b505050505091505090565b606060018060035460ff166004811115610a6557fe5b14610a6f57600080fd5b6006805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529291830182828015610a445780601f10610aca57610100808354040283529160200191610a44565b820191906000526020600020905b815481529060010190602001808311610ad85750939695505050505050565b60408051600160901b6d746f6b656e3a2075706772616465028152815190819003600e019020336000818152600160209081528482208483529052929092205460ff1680610b8757506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b610b9057600080fd5b60038060035460ff166004811115610ba457fe5b14610bae57600080fd5b60095460408051600160b11b692fb9bab832b93ab9b2b9028152815190819003600a018120600160e01b633b424f09028252306004830152602482015260006044820181905291516001600160a01b0390931692633b424f099260648084019391929182900301818387803b158015610c2657600080fd5b505af1158015610c3a573d6000803e3d6000fd5b50505050610c46611ffd565b505050565b60035460ff1681565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff1680610cde57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b610ce757600080fd5b60008060035460ff166004811115610cfb57fe5b14610d0557600080fd5b6003805460ff191660019081179091556040516000805160206135f2833981519152919080825b60ff16815260200191505060405180910390a1505050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff1680610dce57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b610dd757600080fd5b60028060035460ff166004811115610deb57fe5b14610df557600080fd5b428411610e4c5760408051600160e51b62461bcd02815260206004820152601860248201527f63616e6e6f7420706175736520746f2074686520706173740000000000000000604482015290519081900360640190fd5b60048490556040805185815290517f8b00ce48db245d0eb08e3afe42da49e72928dad89be0632e978e09be3f882a1e9181900360200190a150505050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff1680610f1457506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b610f1d57600080fd5b60018060035460ff166004811115610f3157fe5b14610f3b57600080fd5b6003805460ff19166002908117909155600485905560408051918252516000805160206135f28339815191529181900360200190a160045460408051918252517f8b00ce48db245d0eb08e3afe42da49e72928dad89be0632e978e09be3f882a1e9181900360200190a150505050565b600060018060035460ff166004811115610fc157fe5b14610fcb57600080fd5b600960009054906101000a90046001600160a01b03166001600160a01b03166318160ddd6040518163ffffffff1660e01b815260040160206040518083038186803b15801561101957600080fd5b505afa15801561102d573d6000803e3d6000fd5b505050506040513d602081101561104357600080fd5b505191505090565b60008281526020819052604081205460ff16156110b05760405160200180807f455243313832305f4143434550545f4d4147494300000000000000000000000081525060140190506040516020818303038152906040528051906020012090506110b4565b5060005b92915050565b6005546001600160a01b031681565b60408051600160901b6d746f6b656e3a2075706772616465028152815190819003600e019020336000818152600160209081528482208483529052929092205460ff168061115957506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61116257600080fd5b60038060035460ff16600481111561117657fe5b1461118057600080fd5b6005546001600160a01b0316156112265760095460055460408051600160b11b692fb9bab832b93ab9b2b9028152815190819003600a018120600160e01b633b424f090282526001600160a01b039384166004830152602482015260006044820181905291519290931692633b424f09926064808301939282900301818387803b15801561120d57600080fd5b505af1158015611221573d6000803e3d6000fd5b505050505b610c46612098565b60408051600160b11b692fb9bab832b93ab9b2b9028152815190819003600a019020336000818152600160209081528482208483529052929092205460ff16806112ba57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6112c357600080fd5b6001600160a01b0385166000818152600160209081526040808320888452825291829020805460ff1916871515908117909155825190815291518793927f130ea6d934468d638479aa8899db8fe00b15527ac6b7ded4fb291b6423fc128392908290030190a35050505050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff16806113ba57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6113c357600080fd5b60028060035460ff1660048111156113d757fe5b146113e157600080fd5b6003805460ff1916600190811790915560006004556040516000805160206135f283398151915291908082610d2c565b60025481565b600060018060035460ff16600481111561142d57fe5b1461143757600080fd5b505060085490565b60018060035460ff16600481111561145357fe5b1461145d57600080fd5b6114d588888888888080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525050604080516020601f8c018190048102820181019092528a815233935091508a908a908190840183828082843760009201919091525061218492505050565b5050505050505050565b600060018060035460ff1660048111156114f557fe5b146114ff57600080fd5b60095460408051600160e01b6370a082310281526001600160a01b038681166004830152915191909216916370a08231916024808301926020929190829003018186803b15801561154f57600080fd5b505afa158015611563573d6000803e3d6000fd5b505050506040513d602081101561157957600080fd5b50519392505050565b604080517f746f6b656e3a2064697361626c65206d696e74696e670000000000000000000081528151908190036016019020336000818152600160209081528482208483529052929092205460ff168061161e57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61162757600080fd5b600960009054906101000a90046001600160a01b03166001600160a01b0316637e5cd5c16040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561167757600080fd5b505af115801561168b573d6000803e3d6000fd5b505050505050565b6001600160a01b0381163314156116de57604051600160e51b62461bcd02815260040180806020018281038252602a815260200180613711602a913960400191505060405180910390fd5b6001600160a01b0381166000908152600c602052604090205460ff161561172f57336000908152600d602090815260408083206001600160a01b03851684529091529020805460ff1916905561175e565b336000908152600a602090815260408083206001600160a01b03851684529091529020805460ff191660011790555b60405133906001600160a01b038316907ff4caeb2d6ca8932a215a353d0703c326ec2d81fc68170f320eb2ab49e9df61f990600090a350565b606060018060035460ff1660048111156117ad57fe5b146117b757600080fd5b6007805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529291830182828015610a445780601f10610aca57610100808354040283529160200191610a44565b6009546001600160a01b031681565b60018060035460ff16600481111561183557fe5b1461183f57600080fd5b61189133868686868080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920182905250604080516020810190915290815233935091506121849050565b5050505050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff168061192257506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61192b57600080fd5b6001805b60035460ff16600481111561194057fe5b1461194a57600080fd5b6003805460ff191660049081179091556040516000805160206135f283398151915291908082610d2c565b60408051600160901b6d746f6b656e3a2075706772616465028152815190819003600e019020336000818152600160209081528482208483529052929092205460ff1680611a0557506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b611a0e57600080fd5b60018060035460ff166004811115611a2257fe5b14611a2c57600080fd5b60095460408051600160b11b692fb9bab832b93ab9b2b9028152815190819003600a018120600160e01b633b424f090282526001600160a01b03888116600484015260248301919091526001604483015291519190921691633b424f0991606480830192600092919082900301818387803b158015611aaa57600080fd5b505af1158015611abe573d6000803e3d6000fd5b50505050611acb8461294c565b50505050565b6000826040516020018082805190602001908083835b60208310611b065780518252601f199092019160209182019101611ae7565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f1901835284528151918101919091206000818152918290529290208054600160ff199091161790555092505082159050610c4657610c468330612a23565b60408051600160901b6d746f6b656e3a2075706772616465028152815190819003600e019020336000818152600160209081528482208483529052929092205460ff1680611bfb57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b611c0457600080fd5b60018060035460ff166004811115611c1857fe5b14611c2257600080fd5b610c46612b10565b6001600160a01b038082166000908152600a6020908152604080832093861683529290529081205460ff1680611ca957506001600160a01b0383166000908152600c602052604090205460ff168015611ca957506001600160a01b038083166000908152600d602090815260408083209387168352929052205460ff16155b9392505050565b60045481565b60408051600160aa1b6a1d1bdad95b8e881b5a5b9d028152815190819003600b019020336000818152600160209081528482208483529052929092205460ff1680611d4357506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b611d4c57600080fd5b60018060035460ff166004811115611d6057fe5b14611d6a57600080fd5b611d773388888888612c91565b50505050505050565b6001600160a01b038216600090815260016020908152604080832084845290915281205460ff1680611ca9575050506001600160a01b031660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff1690565b6001600160a01b038116331415611e4257604051600160e51b62461bcd02815260040180806020018281038252602d815260200180613612602d913960400191505060405180910390fd5b6001600160a01b0381166000908152600c602052604090205460ff1615611e9657336000908152600d602090815260408083206001600160a01b03851684529091529020805460ff19166001179055611ec2565b336000908152600a602090815260408083206001600160a01b03851684529091529020805460ff191690555b60405133906001600160a01b038316907f50546e66e5f44d728365dc3908c63bc5cfeeab470722c1677e3073a6ac294aa190600090a350565b60018060035460ff166004811115611f0f57fe5b14611f1957600080fd5b611d7733888888888080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525050604080516020601f8c018190048102820181019092528a815292508a915089908190840183828082843760009201919091525061303992505050565b60018060035460ff166004811115611fa357fe5b14611fad57600080fd5b611acb33338686868080601f016020809104026020016040519081016040528093929190818152602001838380828437600092018290525060408051602081019091529081529250613039915050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff168061208757506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61209057600080fd5b60038061192f565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff168061212257506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61212b57600080fd5b60038060035460ff16600481111561213f57fe5b1461214957600080fd5b6003805460ff19166001908117909155600580546001600160a01b03191690556040516000805160206135f283398151915291908082610d2c565b6001600160a01b0385166121cc57604051600160e51b62461bcd0281526004018080602001828103825260268152602001806136eb6026913960400191505060405180910390fd5b60085484816121d757fe5b061561221757604051600160e51b62461bcd02815260040180806020018281038252602881526020018061373b6028913960400191505060405180910390fd5b856001600160a01b0316826001600160a01b031614806122b0575060408051600160e01b63d95b63710281526001600160a01b038481166004830152881660248201529051309163d95b6371916044808301926020929190829003018186803b15801561228357600080fd5b505afa158015612297573d6000803e3d6000fd5b505050506040513d60208110156122ad57600080fd5b50515b6123045760408051600160e51b62461bcd02815260206004820152601360248201527f6e6f7420616c6c6f77656420746f2073656e6400000000000000000000000000604482015290519081900360640190fd5b600061233d87604051806040016040528060128152602001600160711b7122a9219b9b9baa37b5b2b739a9b2b73232b9028152506134e5565b90506001600160a01b038116156124cc57806001600160a01b03166375ab97828489898989886040518763ffffffff1660e01b815260040180876001600160a01b03166001600160a01b03168152602001866001600160a01b03166001600160a01b03168152602001856001600160a01b03166001600160a01b031681526020018481526020018060200180602001838103835285818151815260200191508051906020019080838360005b838110156124015781810151838201526020016123e9565b50505050905090810190601f16801561242e5780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b83811015612461578181015183820152602001612449565b50505050905090810190601f16801561248e5780820380516001836020036101000a031916815260200191505b5098505050505050505050600060405180830381600087803b1580156124b357600080fd5b505af11580156124c7573d6000803e3d6000fd5b505050505b60095460408051600160e01b6370a082310281526001600160a01b038a81166004830152915191909216916370a08231916024808301926020929190829003018186803b15801561251c57600080fd5b505afa158015612530573d6000803e3d6000fd5b505050506040513d602081101561254657600080fd5b505185111561258957604051600160e51b62461bcd0281526004018080602001828103825260258152602001806136836025913960400191505060405180910390fd5b60095460408051600160e31b6317d575990281526001600160a01b038a811660048301528981166024830152604482018990529151919092169163beabacc891606480830192600092919082900301818387803b1580156125e957600080fd5b505af11580156125fd573d6000803e3d6000fd5b505050506000612642876040518060400160405280601581526020017f455243373737546f6b656e73526563697069656e7400000000000000000000008152506134e5565b90506001600160a01b03811661269f5761265b876135eb565b1561269a57604051600160e51b62461bcd0281526004018080602001828103825260438152602001806136a86043913960600191505060405180910390fd5b61281c565b806001600160a01b03166223de29858a8a8a8a896040518763ffffffff1660e01b815260040180876001600160a01b03166001600160a01b03168152602001866001600160a01b03166001600160a01b03168152602001856001600160a01b03166001600160a01b031681526020018481526020018060200180602001838103835285818151815260200191508051906020019080838360005b83811015612751578181015183820152602001612739565b50505050905090810190601f16801561277e5780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b838110156127b1578181015183820152602001612799565b50505050905090810190601f1680156127de5780820380516001836020036101000a031916815260200191505b5098505050505050505050600060405180830381600087803b15801561280357600080fd5b505af1158015612817573d6000803e3d6000fd5b505050505b866001600160a01b0316886001600160a01b0316856001600160a01b03167f06b541ddaa720db2b10a4d0cdac39b8d360425fc073085fac19bc82614677987898988604051808481526020018060200180602001838103835285818151815260200191508051906020019080838360005b838110156128a557818101518382015260200161288d565b50505050905090810190601f1680156128d25780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b838110156129055781810151838201526020016128ed565b50505050905090810190601f1680156129325780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a45050505050505050565b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff16806129d657506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6129df57600080fd5b60018060035460ff1660048111156129f357fe5b146129fd57600080fd5b5050600580546001600160a01b0319166001600160a01b03939093169290921790915550565b6000826040516020018082805190602001908083835b60208310612a585780518252601f199092019160209182019101612a39565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f1901835280855282519290910191909120600160e01b6329965a1d028252306004830152602482018190526001600160a01b03881660448301529251929550731820a4b7618bde71dce8cdc73aab6c95905fad2494506329965a1d9350606480820193600093509182900301818387803b158015612afc57600080fd5b505af1158015611d77573d6000803e3d6000fd5b6040805160008051602061376383398151915281528151908190036019019020336000818152600160209081528482208483529052929092205460ff1680612b9a57506001600160a01b03821660009081526001602090815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b612ba357600080fd5b60018060035460ff166004811115612bb757fe5b14612bc157600080fd5b6005546001600160a01b0316612c215760408051600160e51b62461bcd02815260206004820152601560248201527f6e6f207375706572636564656420616464726573730000000000000000000000604482015290519081900360640190fd5b6003805460ff19168117815560408051918252516000805160206135f28339815191529181900360200190a1600554604080516001600160a01b039092168252517f4e5a4fec27ed62ea9ac3c494ad63ca8f8b4341a187fcf8a79c27e2170d35d3bf9181900360200190a1505050565b6008548381612c9c57fe5b0615612cdc57604051600160e51b62461bcd02815260040180806020018281038252602881526020018061373b6028913960400191505060405180910390fd5b60095460408051600160e01b6340c10f190281526001600160a01b03878116600483015260248201879052915191909216916340c10f1991604480830192600092919082900301818387803b158015612d3457600080fd5b505af1158015612d48573d6000803e3d6000fd5b505050506000612d8d856040518060400160405280601581526020017f455243373737546f6b656e73526563697069656e7400000000000000000000008152506134e5565b90506001600160a01b038116612dea57612da6856135eb565b15612de557604051600160e51b62461bcd02815260040180806020018281038252604481526020018061363f6044913960600191505060405180910390fd5b612f15565b806001600160a01b03166223de298760008888876040518663ffffffff1660e01b815260040180866001600160a01b03166001600160a01b03168152602001856001600160a01b03166001600160a01b03168152602001846001600160a01b03166001600160a01b031681526020018381526020018060200180602001838103835260008152602001602001838103825284818151815260200191508051906020019080838360005b83811015612eab578181015183820152602001612e93565b50505050905090810190601f168015612ed85780820380516001836020036101000a031916815260200191505b50975050505050505050600060405180830381600087803b158015612efc57600080fd5b505af1158015612f10573d6000803e3d6000fd5b505050505b846001600160a01b0316866001600160a01b03167f2fe5be0146f74c5bce36c0b80911af6c7d86ff27e89d5cfa61fc681327954e5d868686604051808481526020018060200180602001838103835285818151815260200191508051906020019080838360005b83811015612f94578181015183820152602001612f7c565b50505050905090810190601f168015612fc15780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b83811015612ff4578181015183820152602001612fdc565b50505050905090810190601f1680156130215780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a3505050505050565b600854838161304457fe5b061561308457604051600160e51b62461bcd02815260040180806020018281038252602881526020018061373b6028913960400191505060405180910390fd5b60095460408051600160e01b6370a082310281526001600160a01b038781166004830152915191909216916370a08231916024808301926020929190829003018186803b1580156130d457600080fd5b505afa1580156130e8573d6000803e3d6000fd5b505050506040513d60208110156130fe57600080fd5b505183111561314157604051600160e51b62461bcd0281526004018080602001828103825260258152602001806136836025913960400191505060405180910390fd5b836001600160a01b0316856001600160a01b031614806131da575060408051600160e01b63d95b63710281526001600160a01b038781166004830152861660248201529051309163d95b6371916044808301926020929190829003018186803b1580156131ad57600080fd5b505afa1580156131c1573d6000803e3d6000fd5b505050506040513d60208110156131d757600080fd5b50515b61322e5760408051600160e51b62461bcd02815260206004820152601360248201527f6e6f7420616c6c6f77656420746f206275726e00000000000000000000000000604482015290519081900360640190fd5b600061326785604051806040016040528060128152602001600160711b7122a9219b9b9baa37b5b2b739a9b2b73232b9028152506134e5565b90506001600160a01b038116156133f757806001600160a01b03166375ab9782878760008888886040518763ffffffff1660e01b815260040180876001600160a01b03166001600160a01b03168152602001866001600160a01b03166001600160a01b03168152602001856001600160a01b03166001600160a01b031681526020018481526020018060200180602001838103835285818151815260200191508051906020019080838360005b8381101561332c578181015183820152602001613314565b50505050905090810190601f1680156133595780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838360005b8381101561338c578181015183820152602001613374565b50505050905090810190601f1680156133b95780820380516001836020036101000a031916815260200191505b5098505050505050505050600060405180830381600087803b1580156133de57600080fd5b505af11580156133f2573d6000803e3d6000fd5b505050505b60095460408051600160e21b632770a7eb0281526001600160a01b0388811660048301526024820188905291519190921691639dc29fac91604480830192600092919082900301818387803b15801561344f57600080fd5b505af1158015613463573d6000803e3d6000fd5b50505050846001600160a01b0316866001600160a01b03167fa78a9be3a7b862d26933ad85fb11d80ef66b8f972d7cbba06621d583943a40988686866040518084815260200180602001806020018381038352858181518152602001915080519060200190808383600083811015612f94578181015183820152602001612f7c565b600080826040516020018082805190602001908083835b6020831061351b5780518252601f1990920191602091820191016134fc565b51815160209384036101000a60001901801990921691161790526040805192909401828103601f19018352808552825192820192909220600160e11b63555ddc650283526001600160a01b038b166004840152602483018190529351939650731820a4b7618bde71dce8cdc73aab6c95905fad24955063aabbb8ca94506044808301949193509091829003018186803b1580156135b757600080fd5b505afa1580156135cb573d6000803e3d6000fd5b505050506040513d60208110156135e157600080fd5b5051949350505050565b3b15159056fea4248ceb280c6f9303d3ba87af96d45c3b0c834338095ab6350dbe86d38c9fc56e6f7420616c6c6f77656420746f2072656d6f766520796f757273656c6620617320616e206f70657261746f7263616e6e6f74206d696e7420746f6b656e7320746f20636f6e7472616374207468617420646f6573206e6f74206578706c696369746c792072656365697665207468656d6e6f7420656e6f75676820746f6b656e7320696e20686f6c6465722773206163636f756e7463616e6e6f742073656e6420746f6b656e7320746f20636f6e7472616374207468617420646f6573206e6f74206578706c696369746c7920616363657074207468656d746f6b656e732063616e6e6f742062652073656e7420746f20746865203020616464726573736e6f7420616c6c6f77656420746f2073657420796f757273656c6620617320616e206f70657261746f72616d6f756e74206d7573742062652061206d756c7469706c65206f66206772616e756c61726974796d616e616765643a206d616e616765206c6966656379636c6500000000000000a165627a7a723058204f30363fbc23ff7ab9cad13ba4366329a5a5cf36ba8854dc11ccf974872f11b30029608060405234801561001057600080fd5b503360008181526020818152604080832081517f5f737570657275736572000000000000000000000000000000000000000000008082528351600a92819003830181208752928552948390208054600160ff19909116811790915594825282519182900301812093815290519293927f130ea6d934468d638479aa8899db8fe00b15527ac6b7ded4fb291b6423fc1283929181900390910190a36004805460ff19166001179055610b0c806100c66000396000f3fe608060405234801561001057600080fd5b50600436106100cf5760003560e01c80639dc29fac1161008c578063beabacc811610066578063beabacc81461021a578063d216dd8314610250578063da46098c1461028c578063e21c4783146102c2576100cf565b80639dc29fac146101ac5780639fd6db12146101d8578063a5841194146101f4576100cf565b806318160ddd146100d45780631a46ec82146100ee5780633b424f091461011c57806340c10f191461015257806370a082311461017e5780637e5cd5c1146101a4575b600080fd5b6100dc6102ee565b60408051918252519081900360200190f35b6100dc6004803603604081101561010457600080fd5b506001600160a01b03813581169160200135166102f4565b6101506004803603606081101561013257600080fd5b506001600160a01b038135169060208101359060400135151561031f565b005b6101506004803603604081101561016857600080fd5b506001600160a01b03813516906020013561041b565b6100dc6004803603602081101561019457600080fd5b50356001600160a01b0316610574565b61015061058f565b610150600480360360408110156101c257600080fd5b506001600160a01b03813516906020013561063e565b6101e061069a565b604080519115158252519081900360200190f35b6101506004803603602081101561020a57600080fd5b50356001600160a01b03166106a3565b6101506004803603606081101561023057600080fd5b506001600160a01b038135811691602081013590911690604001356106a6565b6101506004803603608081101561026657600080fd5b506001600160a01b038135811691602081013582169160408201351690606001356107c8565b610150600480360360608110156102a257600080fd5b506001600160a01b03813581169160208101359091169060400135610940565b6101e0600480360360408110156102d857600080fd5b506001600160a01b038135169060200135610a48565b60015481565b6001600160a01b03918216600090815260036020908152604080832093909416825291909152205490565b60408051600160b11b692fb9bab832b93ab9b2b9028152815190819003600a01902033600081815260208181528482208483529052929092205460ff16806103a757506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6103b057600080fd5b6001600160a01b038516600081815260208181526040808320888452825291829020805460ff1916871515908117909155825190815291518793927f130ea6d934468d638479aa8899db8fe00b15527ac6b7ded4fb291b6423fc128392908290030190a35050505050565b604080517f746f6b656e2073746f726167653a206d696e74000000000000000000000000008152815190819003601301902033600081815260208181528482208483529052929092205460ff16806104b357506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6104bc57600080fd5b60045460ff166105165760408051600160e51b62461bcd02815260206004820152601060248201527f6d696e74696e672064697361626c656400000000000000000000000000000000604482015290519081900360640190fd5b6001600160a01b03841660009081526002602052604090205461053f908463ffffffff610abf16565b6001600160a01b03851660009081526002602052604090205560015461056b908463ffffffff610abf16565b60015550505050565b6001600160a01b031660009081526002602052604090205490565b604080517f746f6b656e2073746f726167653a2064697361626c65206d696e74696e6700008152815190819003601e01902033600081815260208181528482208483529052929092205460ff168061062757506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61063057600080fd5b50506004805460ff19169055565b6001600160a01b038216600090815260026020526040902054610667908263ffffffff610ace16565b6001600160a01b038316600090815260026020526040902055600154610693908263ffffffff610ace16565b6001555050565b60045460ff1681565b50565b604080517f746f6b656e2073746f726167653a207472616e736665720000000000000000008152815190819003601701902033600081815260208181528482208483529052929092205460ff168061073e57506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61074757600080fd5b6001600160a01b038516600090815260026020526040902054610770908463ffffffff610ace16565b6001600160a01b0380871660009081526002602052604080822093909355908616815220546107a5908463ffffffff610abf16565b6001600160a01b0390941660009081526002602052604090209390935550505050565b604080517f746f6b656e2073746f726167653a2075736520616c6c6f77616e6365000000008152815190819003601c01902033600081815260208181528482208483529052929092205460ff168061086057506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b61086957600080fd5b6001600160a01b038087166000818152600360209081526040808320948a168352938152838220549282526002905291909120546108ad908563ffffffff610ace16565b6001600160a01b0380891660009081526002602052604080822093909355908716815220546108e2908563ffffffff610abf16565b6001600160a01b03861660009081526002602052604090205561090b818563ffffffff610ace16565b6001600160a01b03978816600090815260036020908152604080832099909a1682529790975296909520959095555050505050565b604080517f746f6b656e2073746f726167653a2073657420616c6c6f77616e6365000000008152815190819003601c01902033600081815260208181528482208483529052929092205460ff16806109d857506001600160a01b0382166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b6109e157600080fd5b821580610a1157506001600160a01b03808616600090815260036020908152604080832093881683529290522054155b610a1a57600080fd5b50506001600160a01b0392831660009081526003602090815260408083209490951682529290925291902055565b6001600160a01b03821660009081526020818152604080832084845290915281205460ff1680610ab857506001600160a01b0383166000908152602081815260408083208151600160b11b692fb9bab832b93ab9b2b9028152825190819003600a019020845290915290205460ff165b9392505050565b600082820183811015610ab857fe5b600082821115610ada57fe5b5090039056fea165627a7a72305820e1acbfad52a370930ed8781beed09f3cea1b60c9be043580fe981cdcf595b1d30029696e697469616c20737570706c79206d7573742062652061206d756c7469706c65206f66206772616e756c61726974796772616e756c6172697479206d7573742062652067726561746572207468616e203063616e6e6f74206d696e7420746f6b656e7320746f20636f6e7472616374207468617420646f6573206e6f74206578706c696369746c792072656365697665207468656d616d6f756e74206d7573742062652061206d756c7469706c65206f66206772616e756c6172697479")

	constructor := common.FromHex("000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000052b7d2dcc80cd2e400000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001254657374204552432d37373720546f6b656e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000645524337373700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")

	// Set the granularity
	gBytes := granularity.Bytes()
	copy(constructor[128-len(gBytes):128], gBytes)

	// Deploy the contract
	data := make([]byte, 0)
	data = append(data, bin...)
	data = append(data, constructor...)
	contractAddress, err := tc.DeployContract(tc.Accounts[127], big.NewInt(0), data)
	if err != nil {
		return nil, err
	}
	tc.Chain.Commit()

	// Now activate the token
	activateData := []byte{0x0f, 0x15, 0xf4, 0xc0}
	tx, err := tc.CreateSignedTransaction(tc.Accounts[127], contractAddress, _bigInt("0"), activateData)
	if err != nil {
		return nil, err
	}
	err = tc.Chain.SendTransaction(context.Background(), tx)
	if err != nil {
		return nil, err
	}
	tc.Chain.Commit()

	return contractAddress, nil
}
